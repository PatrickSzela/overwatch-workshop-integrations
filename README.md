# Overwatch Workshop Integrations

A proof-of-concept application enabling control of Custom Games from external sources

> [!NOTE]
> This application is still in very early stages of development

### Currently supported integrations:

- Twitch

## Requirements

- PC with Windows or Linux operating system
- Python 3.13 or higher installed
- Good knowledge of Python and virtual environments
- Overwatch account with both _Enable Workshop Inspector_ and _Enable Workshop Inspector Log File_ enabled in Options (under _Gameplay_ → _General_ → _Custom Games - Workshop_)
- Being a **host (owner)** and **spectator** of the Custom Game lobby
- Having the Overwatch client continuously focused after starting a Custom Game, not interacting with your PC and not being in any menu
- Having properly set your keybinds (under _Controls_ → _Spectate_):

| Section         | Name                    | Keybind                             |
| --------------- | ----------------------- | ----------------------------------- |
| Spectate        | Spectate Lock On        | Left Mouse Button                   |
| User Interface  | Modify FOV              | **F** **(not assigned by default)** |
| Camera Movement | Disable Camera Blending | Z                                   |
| Camera Movement | Move Fast               | Left Shift                          |
| Camera Movement | Move Slow               | Left Ctrl                           |
| Camera Movement | Move Down               | Q                                   |
| Camera Movement | Move Up                 | E                                   |

> [!IMPORTANT]
> Except for _Modify FOV_, **which doesn't have any key assigned**, the keybinds above should match the default in-game keybinds
>
> These keys are currently hardcoded in the tool and there's no way to change them, so for now you're going to have to match them in-game. In the future that should change

## Installation

1. Clone this repository
2. Create and activate Python virtual environment
3. Install dependencies:
   `pip install -r requirements.txt`
4. **For Linux users:** Install [ydotool](https://github.com/ReimuNotMoe/ydotool) (and, optionally, [configure it to not require root privileges](https://github.com/ideasman42/nerd-dictation/blob/main/readme-ydotool.rst#configuring-ydotool))

Additionally:

1. **For Twitch integration** you'll need to [register your application on Twitch](https://dev.twitch.tv/console/apps/create):
   1. Fill out the **Name**, **Category** and **Client type** fields as desired
   2. Under **OAuth Redirect URLs** provide this URL: `http://localhost:17563`
   3. Create the application
   4. Save the generated **Client ID** and **Client secret** somewhere safe

## Usage

1. Activate the Python virtual environment if not active already
2. Execute the `main.py` script
3. If this is your first time running this application, you'll need to provide the necessary information:
   1. Path to the Overwatch directory in your Documents folder
      - **Windows users:** for majority of users, you won't have to provide this information, unless you've changed the location of your Documents or Overwatch folders
      - **Linux users:** will need to provide a path to the `Documents/Overwatch` folder in their Proton/Wine prefix:
        - For Proton (Steam): `{STEAM_LIBRARY_FOLDER}/compatdata/2357570/pfx/drive_c/users/steamuser/Documents/Overwatch`
        - For Wine: the location depends on how you've set up your game, so you're on your own here
   2. **For Twitch integration** provide the following keys generated during registration of your application:
      - **Client ID** as `application ID`
      - **Client secret** as `application secret key`
4. **For Linux users:** start Ydotool daemon `ydotoold`
5. Start a Custom Game that supports this application (for example [Mystery Modifiers](https://workshop.codes/mystery-modifiers)). Don't forget to move yourself to a spectator slot!

## How does this app works?

This application serves as a "bridge" between external services and the Workshop mode.

To achieve this, this application encodes and forwards all data to the game, by sending virtual inputs to the game's client. For this reason, **the game's client must be continuously focused** and **the user must not interact with it** while inputs are being sent. It's also required that the owner of the lobby must be a spectator.

To receive information from the game and forward it to an external service, this application continuously reads and parses a Workshop log file, generated by currently hosted Custom Game. Every message (that's supposed to be forwarded to this application) is (internally) being converted to a JSON array of key-pair values by the Workshop mode, and then appended the log file, which is later being parsed by this application. Invalid messages are ignored to allow debugging of the Workshop mode.

The application automatically detects when the log file is being created, modified and closed. Once a log file is created, the application will start monitoring it for any changes. Creation of the log file also means that the Custom Game has started. Once the Custom Game finishes or is restarted, the game's client closes the log file.

More information about how it works will be provided in the future.

## FAQ

### I want to host and play with my community a mode that utilizes this application

Unfortunately, there's no easy solution for that. Because the app requires the lobby's host to be a spectator and they must not be interacting with their PC after the game starts, it's not possible for them to play that mode. You could either use an alternative Overwatch account on a separate PC to host the lobby, or ask a trusted member of your community to do that for you.

### Does every player in the lobby needs to install this application?

No, only the host of the lobby needs to use it.

### I want to host a Custom Game that utilizes this app and use my PC in the meantime

Unfortunately that's not possible.

### I want to host a Custom Game that utilizes this app and talk in Twitch chat in the meantime

Unfortunately that's not possible, at least not from the PC that's used to host the Custom Game. You must use a different device to talk in Twitch chat.

### I want to pause the game after starting the mode

Because there's no way for the app to know when the game is paused or not, you can only pause it when application isn't sending any inputs to the game (see output in the console to know when that's happening). Otherwise the app will keep trying (and failing) to send them.

### Sometimes the bot's messages don't show up in chat

To combat spam, Twitch limits how quickly users can send messages in chat, which can sometimes cause bot's messages to not show up in chat, especially if the user whose account is being used for a bot is also sending messages from a different device. To workaround that, make sure that the account that's being used for a bot has (at least) a VIP status in your chat.

### I want to make my own Workshop mode that utilizes this application

The app is still in very early stages of development and there might be changes to how the bridge works in the future, requiring you to update your mode. Additionally, testing the integration is very difficult because of how the bridge works. For these reasons, I personally wouldn't recommend making your own modes that utilize this application, at least not until I release a stable version.

### Can I get banned for using this application?

I can't get a definitive answer to this question, but the chances of that happening are very low. I've personally hosted Custom Game lobbies in the past that utilized this application (shoutout to KarQ), and my account is still in a good standing. Just to be safe, make sure to close this app once you've finished hosting the Custom Game.
